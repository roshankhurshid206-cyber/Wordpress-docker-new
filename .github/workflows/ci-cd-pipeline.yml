name: Docker Image Build and Push

on:
    push:
          branches:
                  - main 

          jobs:
              build-and-deploy:
                    runs-on: ubuntu-latest
                          permissions:
                                  contents: read
                                          packages: write 

                                                steps:
                                                        - name: Checkout Repository
                                                                  uses: actions/checkout@v4

                                                                          - name: Log in to GitHub Container Registry
                                                                                    uses: docker/login-action@v3
                                                                                              with:
                                                                                                          registry: ghcr.io
                                                                                                                      username: ${{ github.actor }}
                                                                                                                                  password: ${{ secrets.GITHUB_TOKEN }} 

                                                                                                                                          - name: Generate Image Tags and Metadata
                                                                                                                                                    id: meta
                                                                                                                                                              uses: docker/metadata-action@v5
                                                                                                                                                                        with:
                                                                                                                                                                                    images: ghcr.io/${{ github.repository }} 
                                                                                                                                                                                                tags: |
                                                                                                                                                                                                              type=sha,prefix=,suffix=,enable=true
                                                                                                                                                                                                                          type=raw,value=latest,enable={{is_default_branch}} 

                                                                                                                                                                                                                                - name: Build and Push Docker Image
                                                                                                                                                                                                                                          uses: docker/build-and-push-action@v5
                                                                                                                                                                                                                                                    with:
                                                                                                                                                                                                                                                                context: . 
                                                                                                                                                                                                                                                                            push: true
                                                                                                                                                                                                                                                                                        tags: ${{ steps.meta.outputs.tags }}
                                                                                                                                                                                                                                                                                                    labels: ${{ steps.meta.outputs.labels }}
                                                                                                                                                                                                                                                                                                                file: ./Dockerfile
