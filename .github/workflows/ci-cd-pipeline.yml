# --- FINAL DEPLOYMENT STEP: Using the correct sync parameter for @v1 ---
            - name: Deploy to EC2 Instance
              # Using the stable major version tag (v1)
              uses: appleboy/ssh-action@v1 
              with:
                  host: ${{ secrets.EC2_HOST }}
                  username: ${{ secrets.EC2_USER }}
                  key: ${{ secrets.EC2_SSH_KEY }}
                  
                  # The only valid file transfer input for @v1 is 'sync: true'. 
                  # 'source' and 'target' must be removed entirely.
                  sync: true
                  
                  script: |
                      # 0. Setup: Ensure tools are present
                      sudo apt update && sudo apt install -y docker-compose || true 
                      
                      # Create the target directory
                      mkdir -p /home/${{ secrets.EC2_USER }}/Wordpress-docker-new
                      
                      # The files are synced to /home/<user>/, so we move them into the target sub-directory
                      # This mv command is now safe as we don't try to move the sub-directory itself.
                      mv -f /home/${{ secrets.EC2_USER }}/* /home/${{ secrets.EC2_USER }}/Wordpress-docker-new/
                      
                      # Change to the target directory
                      cd /home/${{ secrets.EC2_USER }}/Wordpress-docker-new
                      
                      # Fix file ownership (required after file transfer/sync for docker-compose access)
                      sudo chown -R ${{ secrets.EC2_USER }}:${{ secrets.EC2_USER }} .
                      
                      # 1. Log in to GHCR on the EC2 instance
                      docker login ghcr.io -u ${{ github.actor }} -p ${{ secrets.GITHUB_TOKEN }}

                      # 2. Stop and remove old containers, then deploy new ones
                      docker-compose down || true
                      docker-compose pull
                      docker-compose up -d --build
